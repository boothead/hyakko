<!DOCTYPE html>

<html>
<head>
  <title>Hyakko.hs</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="hyakko.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
          <div id="jump_to">
        Jump To &hellip;
        <div id="jump_wrapper">
          <div id="jump_page">
<a class='source' href='Hyakko.html'>
  Hyakko.hs
</a>
<a class='source' href='Markdown.html'>
  Markdown.hs
</a>
          </div>
        </div>
      </div>
        <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th class="docs">
            <h1>
              Hyakko.hs
            </h1>
          </th>
          <th class="code">
          </th>
        </tr>
      </thead>
      <tbody>
<tr id='section-1'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-1'>&#955;</a>
    </div>
<p><strong>Hyakko</strong> is a Haskell port of <a href="http://jashkenas.github.com/docco/">docco</a>: the original quick-and-dirty, hundred-line-line, literate-programming-style documentation generator. It produces HTML that displays your comments alongside your code. Comments are passed through <a href="http://daringfireball.net/projects/markdown/syntax">Markdown</a> and code is passed through <a href="http://pygments.org/">Pygments</a> syntax highlighting. This page is the result of running Hyakko against its own source file.</p>
<p>If you install Hyakko, you can run it from the command-line:</p>
<pre><code> hyakko src/*.hs
</code></pre>
<p>...will generate linked HTML documentation for the named source files, saving it into a <code>docs</code> folder.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Text.Markdown</span>

<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Map</span> <span class="k">as</span> <span class="n">M</span>
<span class="kr">import</span> <span class="nn">Data.List</span> <span class="p">(</span><span class="nf">sort</span><span class="p">,</span> <span class="nf">groupBy</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Text.Pandoc.Templates</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="kr">import</span> <span class="nn">Text.Regex.Posix</span> <span class="p">((</span><span class="o">=~</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">System.Environment</span> <span class="p">(</span><span class="nf">getArgs</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">System.FilePath</span> <span class="p">(</span><span class="nf">takeBaseName</span><span class="p">,</span> <span class="nf">takeExtension</span><span class="p">,</span> <span class="nf">takeFileName</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">System.Process</span> <span class="p">(</span><span class="nf">system</span><span class="p">,</span> <span class="nf">readProcess</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Paths_hyakko</span> <span class="p">(</span><span class="nf">getDataFileName</span><span class="p">)</span></pre></div>
  </td>
</tr>
<tr id='section-2'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-2'>&#955;</a>
    </div>
<h3 id="main-documentation-generation-functions">Main Documentation Generation Functions</h3>
  </td>
  <td class='code'>
<div class="highlight"><pre></pre></div>
  </td>
</tr>
<tr id='section-3'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-3'>&#955;</a>
    </div>
<p>Make type signature more readable with these two <code>Callback</code> types.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="kr">type</span> <span class="kt">Callback</span>  <span class="ow">=</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="kr">type</span> <span class="kt">Callback&#39;</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">M</span><span class="o">.</span><span class="kt">Map</span> <span class="kt">String</span> <span class="kt">String</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span></pre></div>
  </td>
</tr>
<tr id='section-4'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-4'>&#955;</a>
    </div>
<p>Generate the documentation for a source file by reading it in, splitting it up into comment/code sections, highlighting them for the appropriate language, and merging them into an HTML template.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">generateDocumentation</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">FilePath</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">generateDocumentation</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">code</span> <span class="ow">&lt;-</span> <span class="n">readFile</span> <span class="n">x</span>
  <span class="kr">let</span> <span class="n">sections</span> <span class="ow">=</span> <span class="n">parse</span> <span class="n">x</span> <span class="n">code</span>
  <span class="n">highlight</span> <span class="n">x</span> <span class="n">sections</span> <span class="o">$</span> <span class="nf">\</span><span class="n">y</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
    <span class="n">generateHTML</span> <span class="n">x</span> <span class="n">y</span>
    <span class="kr">if</span> <span class="n">null</span> <span class="n">xs</span> <span class="kr">then</span> <span class="n">return</span> <span class="nb">()</span> <span class="kr">else</span> <span class="n">generateDocumentation</span> <span class="n">xs</span></pre></div>
  </td>
</tr>
<tr id='section-5'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-5'>&#955;</a>
    </div>
<p>Given a string of source code, parse out each comment and the code that follows it, and create an individual <strong>section</strong> for it. Sections take the form:</p>
<pre><code>{
  docs_text: ...
  docs_html: ...
  code_text: ...
  code_html: ...
}
</code></pre>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">inSections</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">M</span><span class="o">.</span><span class="kt">Map</span> <span class="kt">String</span> <span class="kt">String</span><span class="p">]</span>
<span class="nf">inSections</span> <span class="n">xs</span> <span class="n">r</span> <span class="ow">=</span>
  <span class="kr">let</span> <span class="n">s1</span> <span class="ow">=</span> <span class="n">groupBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="n">y</span> <span class="ow">-&gt;</span>
             <span class="n">and</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">z</span> <span class="ow">-&gt;</span>
               <span class="n">z</span> <span class="o">=~</span> <span class="n">r</span><span class="p">)</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span> <span class="n">xs</span>
      <span class="n">s2</span> <span class="ow">=</span> <span class="n">groupBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="n">y</span> <span class="ow">-&gt;</span>
             <span class="n">and</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">z</span> <span class="ow">-&gt;</span>
               <span class="n">not</span> <span class="o">$</span> <span class="n">z</span> <span class="o">!!</span> <span class="mi">0</span> <span class="o">=~</span> <span class="n">r</span><span class="p">)</span> <span class="p">[</span><span class="n">x</span> <span class="p">,</span> <span class="n">y</span><span class="p">])</span> <span class="n">s1</span>
      <span class="n">s3</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">concat</span> <span class="n">x</span><span class="p">)</span> <span class="n">s2</span>
        <span class="kr">in</span> <span class="kr">if</span> <span class="n">even</span> <span class="o">$</span> <span class="n">length</span> <span class="n">s</span> <span class="kr">then</span> <span class="n">s</span> <span class="kr">else</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">]</span><span class="kt">:</span><span class="n">s</span>
      <span class="n">replace</span> <span class="ow">=</span> <span class="n">unlines</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">y</span> <span class="ow">-&gt;</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="n">r</span><span class="p">)</span> <span class="n">y</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
      <span class="n">clump</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">y</span><span class="kt">:</span><span class="n">ys</span><span class="p">)</span> <span class="ow">=</span> <span class="p">[(</span><span class="s">&quot;docsText&quot;</span><span class="p">,</span> <span class="n">replace</span> <span class="n">x</span><span class="p">),(</span><span class="s">&quot;codeText&quot;</span><span class="p">,</span> <span class="n">unlines</span> <span class="n">y</span><span class="p">)]</span> <span class="kt">:</span>
        <span class="kr">if</span> <span class="n">null</span> <span class="n">ys</span> <span class="kr">then</span> <span class="kt">[]</span> <span class="kr">else</span> <span class="n">clump</span> <span class="n">ys</span>
  <span class="kr">in</span> <span class="p">[</span><span class="kt">M</span><span class="o">.</span><span class="n">fromList</span> <span class="n">l</span> <span class="o">|</span> <span class="n">l</span> <span class="ow">&lt;-</span> <span class="n">clump</span> <span class="n">s3</span><span class="p">]</span>

<span class="nf">parse</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">M</span><span class="o">.</span><span class="kt">Map</span> <span class="kt">String</span> <span class="kt">String</span><span class="p">]</span>
<span class="nf">parse</span> <span class="n">src</span> <span class="n">code</span> <span class="ow">=</span>
  <span class="kr">let</span> <span class="n">line</span>     <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="s">&quot;#!&quot;</span> <span class="o">/=</span> <span class="n">take</span> <span class="mi">2</span> <span class="n">x</span><span class="p">)</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">code</span>
      <span class="n">language</span> <span class="ow">=</span> <span class="n">getLanguage</span> <span class="n">src</span>
  <span class="kr">in</span> <span class="n">inSections</span> <span class="n">line</span> <span class="o">$</span> <span class="n">language</span> <span class="kt">M</span><span class="o">.!</span> <span class="s">&quot;comment&quot;</span></pre></div>
  </td>
</tr>
<tr id='section-6'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-6'>&#955;</a>
    </div>
<p>Highlights a single chunk of Haskell code, using <strong>Pygments</strong> over stdio, and runs the text of its corresponding comment through <strong>Markdown</strong>, using the Markdown translator in <strong><a href="http://johnmacfarlane.net/pandoc/">Pandoc</a></strong>.</p>
<p>We process the entire file in a single call to Pygments by inserting little marker comments between each section and then splitting the result string wherever our markers occur.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">highlight</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">M</span><span class="o">.</span><span class="kt">Map</span> <span class="kt">String</span> <span class="kt">String</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Callback&#39;</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">highlight</span> <span class="n">src</span> <span class="n">section</span> <span class="n">cb</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="kr">let</span> <span class="n">language</span> <span class="ow">=</span> <span class="n">getLanguage</span> <span class="n">src</span>
      <span class="n">options</span>  <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="n">language</span> <span class="kt">M</span><span class="o">.!</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="s">&quot;html&quot;</span><span class="p">,</span> <span class="s">&quot;-O&quot;</span><span class="p">,</span> <span class="s">&quot;encoding=utf-8&quot;</span><span class="p">]</span>
      <span class="n">input</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="kt">M</span><span class="o">.!</span> <span class="s">&quot;codeText&quot;</span><span class="o">++</span><span class="p">(</span><span class="n">language</span> <span class="kt">M</span><span class="o">.!</span> <span class="s">&quot;dividerText&quot;</span><span class="p">))</span> <span class="n">section</span>

  <span class="n">output</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;pygmentize&quot;</span> <span class="n">options</span> <span class="n">input</span>

  <span class="kr">let</span> <span class="n">output&#39;</span>   <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="n">highlightReplace</span><span class="p">)</span> <span class="n">output</span> <span class="s">&quot;&quot;</span>
      <span class="n">fragments</span> <span class="ow">=</span> <span class="n">splitRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="o">$</span> <span class="n">language</span> <span class="kt">M</span><span class="o">.!</span> <span class="s">&quot;dividerHtml&quot;</span><span class="p">)</span> <span class="n">output&#39;</span>

  <span class="n">cb</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">section</span> <span class="o">!!</span> <span class="n">x</span>
    <span class="kr">in</span> <span class="kt">M</span><span class="o">.</span><span class="n">insert</span> <span class="s">&quot;docsHtml&quot;</span> <span class="p">(</span><span class="n">toHTML</span> <span class="o">$</span> <span class="n">s</span> <span class="kt">M</span><span class="o">.!</span> <span class="s">&quot;docsText&quot;</span><span class="p">)</span> <span class="o">$</span>
       <span class="kt">M</span><span class="o">.</span><span class="n">insert</span> <span class="s">&quot;codeHtml&quot;</span> <span class="p">(</span><span class="n">highlightStart</span> <span class="o">++</span> <span class="p">(</span><span class="n">fragments</span> <span class="o">!!</span> <span class="n">x</span><span class="p">)</span> <span class="o">++</span>
         <span class="n">highlightEnd</span><span class="p">)</span> <span class="n">s</span><span class="p">)</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="p">(</span><span class="n">length</span> <span class="n">section</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span></pre></div>
  </td>
</tr>
<tr id='section-7'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-7'>&#955;</a>
    </div>
<p>Once all of the code is finished highlighting, we can generate the HTML file and write out the documentation. Pass the completed sections into the template found in <code>resources/hyakko.html</code></p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">generateHTML</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">M</span><span class="o">.</span><span class="kt">Map</span> <span class="kt">String</span> <span class="kt">String</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">generateHTML</span> <span class="n">src</span> <span class="n">section</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="kr">let</span> <span class="n">title</span> <span class="ow">=</span> <span class="n">takeFileName</span> <span class="n">src</span>
      <span class="n">dest</span>  <span class="ow">=</span> <span class="n">destination</span> <span class="n">src</span>
  <span class="n">source</span> <span class="ow">&lt;-</span> <span class="n">sources</span>
  <span class="n">html</span> <span class="ow">&lt;-</span> <span class="n">hyakkoTemplate</span> <span class="o">$</span> <span class="n">concat</span> <span class="p">[</span>
    <span class="p">[(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">)],</span>
    <span class="kr">if</span> <span class="n">length</span> <span class="n">source</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span> <span class="p">[(</span><span class="s">&quot;multi&quot;</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">)]</span> <span class="kr">else</span> <span class="kt">[]</span><span class="p">,</span>
    <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;source&quot;</span><span class="p">,</span> <span class="n">unlines</span> <span class="p">[</span>
      <span class="s">&quot;&lt;a class=&#39;source&#39; href=&#39;&quot;</span><span class="o">++</span><span class="p">(</span><span class="n">takeFileName</span> <span class="o">$</span> <span class="n">destination</span> <span class="n">x</span><span class="p">)</span><span class="o">++</span><span class="s">&quot;&#39;&gt;&quot;</span><span class="p">,</span>
      <span class="s">&quot;  &quot;</span><span class="o">++</span><span class="n">takeFileName</span> <span class="n">x</span><span class="p">,</span><span class="s">&quot;&lt;/a&gt;&quot;</span><span class="p">]))</span> <span class="n">source</span><span class="p">,</span>
    <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="s">&quot;section&quot;</span><span class="p">,</span> <span class="n">unlines</span> <span class="p">[</span>
      <span class="s">&quot;&lt;tr id=&#39;section-&quot;</span><span class="o">++</span><span class="n">show</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">++</span><span class="s">&quot;&#39;&gt;&quot;</span><span class="p">,</span>
      <span class="s">&quot;  &lt;td class=&#39;docs&#39;&gt;&quot;</span><span class="p">,</span>
      <span class="s">&quot;    &lt;div class=&#39;pilwrap&#39;&gt;&quot;</span><span class="p">,</span>
      <span class="s">&quot;      &lt;a class=&#39;pilcrow&#39; href=&#39;#section-&quot;</span><span class="o">++</span><span class="n">show</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">++</span><span class="s">&quot;&#39;&gt;&amp;#955;&lt;/a&gt;&quot;</span><span class="p">,</span>
      <span class="s">&quot;    &lt;/div&gt;&quot;</span><span class="p">,</span>
      <span class="p">(</span><span class="n">section</span> <span class="o">!!</span> <span class="n">x</span><span class="p">)</span> <span class="kt">M</span><span class="o">.!</span> <span class="s">&quot;docsHtml&quot;</span><span class="p">,</span>
      <span class="s">&quot;  &lt;/td&gt;&quot;</span><span class="p">,</span>
      <span class="s">&quot;  &lt;td class=&#39;code&#39;&gt;&quot;</span><span class="p">,</span>
      <span class="p">(</span><span class="n">section</span> <span class="o">!!</span> <span class="n">x</span><span class="p">)</span> <span class="kt">M</span><span class="o">.!</span> <span class="s">&quot;codeHtml&quot;</span><span class="p">,</span>
      <span class="s">&quot;  &lt;/td&gt;&quot;</span><span class="p">,</span>
      <span class="s">&quot;&lt;/tr&gt;&quot;</span> <span class="p">]))</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="p">(</span><span class="n">length</span> <span class="n">section</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">]</span>
  <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;hyakko: &quot;</span> <span class="o">++</span> <span class="n">src</span> <span class="o">++</span> <span class="s">&quot; -&gt; &quot;</span> <span class="o">++</span> <span class="n">dest</span>
  <span class="n">writeFile</span> <span class="n">dest</span> <span class="n">html</span></pre></div>
  </td>
</tr>
<tr id='section-8'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-8'>&#955;</a>
    </div>
<h3 id="helpers-setup">Helpers &amp; Setup</h3>
  </td>
  <td class='code'>
<div class="highlight"><pre></pre></div>
  </td>
</tr>
<tr id='section-9'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-9'>&#955;</a>
    </div>
<p>A list of the languages that Hyakko supports, mapping the file extension to the name of the Pygments lexer and the symbol that indicates a comment. To add another language to Hyakko's repertoire, add it here.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">languages</span> <span class="ow">::</span> <span class="kt">M</span><span class="o">.</span><span class="kt">Map</span> <span class="kt">String</span> <span class="p">(</span><span class="kt">M</span><span class="o">.</span><span class="kt">Map</span> <span class="kt">String</span> <span class="kt">String</span><span class="p">)</span>
<span class="nf">languages</span> <span class="ow">=</span> <span class="kt">M</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;.hs&quot;</span><span class="p">,</span> <span class="kt">M</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span>
              <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;haskell&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;symbol&quot;</span><span class="p">,</span> <span class="s">&quot;--&quot;</span><span class="p">),</span>
              <span class="p">(</span><span class="s">&quot;comment&quot;</span><span class="p">,</span> <span class="s">&quot;^( |</span><span class="se">\t</span><span class="s">)*-- ?&quot;</span><span class="p">),</span>
              <span class="p">(</span><span class="s">&quot;dividerText&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">--DIVIDER</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span>
              <span class="p">(</span><span class="s">&quot;dividerHtml&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">*&lt;span class=</span><span class="se">\&quot;</span><span class="s">c1?</span><span class="se">\&quot;</span><span class="s">&gt;--DIVIDER&lt;/span&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)])</span>
            <span class="p">]</span></pre></div>
  </td>
</tr>
<tr id='section-10'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-10'>&#955;</a>
    </div>
<p>Get the current language we're documenting, based on the extension.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">getLanguage</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">M</span><span class="o">.</span><span class="kt">Map</span> <span class="kt">String</span> <span class="kt">String</span>
<span class="nf">getLanguage</span> <span class="n">src</span> <span class="ow">=</span> <span class="n">languages</span> <span class="kt">M</span><span class="o">.!</span> <span class="n">takeExtension</span> <span class="n">src</span></pre></div>
  </td>
</tr>
<tr id='section-11'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-11'>&#955;</a>
    </div>
<p>Compute the destination HTML path for an input source file path. If the source is <code>lib/example.hs</code>, the HTML will be at docs/example.html</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">destination</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">FilePath</span>
<span class="nf">destination</span> <span class="n">fp</span> <span class="ow">=</span> <span class="s">&quot;docs/&quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">takeBaseName</span> <span class="n">fp</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot;.html&quot;</span></pre></div>
  </td>
</tr>
<tr id='section-12'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-12'>&#955;</a>
    </div>
<p>Ensure that the destination directory exists.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">ensureDirectory</span> <span class="ow">::</span> <span class="kt">Callback</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">ensureDirectory</span> <span class="n">cb</span> <span class="ow">=</span> <span class="n">system</span> <span class="s">&quot;mkdir -p docs&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">cb</span></pre></div>
  </td>
</tr>
<tr id='section-13'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-13'>&#955;</a>
    </div>
<p>Create the template that we will use to generate the Hyakko HTML page.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">hyakkoTemplate</span> <span class="ow">::</span> <span class="p">[(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)]</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">String</span>
<span class="nf">hyakkoTemplate</span> <span class="n">var</span> <span class="ow">=</span> <span class="n">readDataFile</span> <span class="s">&quot;resources/hyakko.html&quot;</span> <span class="o">&gt;&gt;=</span>
  <span class="n">return</span> <span class="o">.</span> <span class="n">renderTemplate</span> <span class="n">var</span></pre></div>
  </td>
</tr>
<tr id='section-14'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-14'>&#955;</a>
    </div>
<p>The CSS styles we'd like to apply to the documentation.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">hyakkoStyles</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">String</span>
<span class="nf">hyakkoStyles</span> <span class="ow">=</span> <span class="n">readDataFile</span> <span class="s">&quot;resources/hyakko.css&quot;</span></pre></div>
  </td>
</tr>
<tr id='section-15'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-15'>&#955;</a>
    </div>
<p>The start and end of each Pygments highlight block.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">highlightStart</span><span class="p">,</span> <span class="n">highlightEnd</span><span class="p">,</span> <span class="n">highlightReplace</span> <span class="ow">::</span> <span class="kt">String</span>
<span class="nf">highlightStart</span>   <span class="ow">=</span> <span class="s">&quot;&lt;div class=</span><span class="se">\&quot;</span><span class="s">highlight</span><span class="se">\&quot;</span><span class="s">&gt;&lt;pre&gt;&quot;</span>
<span class="nf">highlightEnd</span>     <span class="ow">=</span> <span class="s">&quot;&lt;/pre&gt;&lt;/div&gt;&quot;</span>
<span class="nf">highlightReplace</span> <span class="ow">=</span> <span class="n">highlightStart</span> <span class="o">++</span> <span class="s">&quot;|&quot;</span> <span class="o">++</span> <span class="n">highlightEnd</span>

<span class="nf">readDataFile</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">String</span>
<span class="nf">readDataFile</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">getDataFileName</span> <span class="n">f</span> <span class="o">&gt;&gt;=</span> <span class="n">readFile</span></pre></div>
  </td>
</tr>
<tr id='section-16'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-16'>&#955;</a>
    </div>
<p>For each source file passed in as an argument, generate the documentation.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">sources</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="p">[</span><span class="kt">FilePath</span><span class="p">]</span>
<span class="nf">sources</span> <span class="ow">=</span> <span class="n">getArgs</span> <span class="o">&gt;&gt;=</span> <span class="n">return</span> <span class="o">.</span> <span class="n">sort</span></pre></div>
  </td>
</tr>
<tr id='section-17'>
  <td class='docs'>
    <div class='pilwrap'>
      <a class='pilcrow' href='#section-17'>&#955;</a>
    </div>
<p>Run the script.</p>
  </td>
  <td class='code'>
<div class="highlight"><pre><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">style</span> <span class="ow">&lt;-</span> <span class="n">hyakkoStyles</span>
  <span class="n">source</span> <span class="ow">&lt;-</span> <span class="n">sources</span>
  <span class="n">ensureDirectory</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">writeFile</span> <span class="s">&quot;docs/hyakko.css&quot;</span> <span class="n">style</span>
    <span class="n">generateDocumentation</span> <span class="n">source</span></pre></div>
  </td>
</tr>
      </tbody>
    </table>
  </div>
</body>
</html>
